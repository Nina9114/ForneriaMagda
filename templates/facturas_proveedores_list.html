{% extends "base.html" %}
{% load static %}

{% block contenido %}
<div class="dashboard-main-container">
    {% include 'includes/sidebar.html' with active_page='facturas_proveedores' %}
    
    <div class="dashboard-content-wrapper">
        <header class="dashboard-header">
            <h1 class="dashboard-main-title">Facturas de Proveedores</h1>
            <div class="header-actions">
                <a href="{% url 'factura_proveedor_crear' %}" class="btn btn-primary">
                    <span>➕</span> Nueva Factura
                </a>
            </div>
        </header>
        
        <main class="dashboard-content">
            <!-- Resumen de facturas -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Total Facturas</h5>
                            <h3 class="text-primary">{{ total_facturas }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Monto Total</h5>
                            <h3 class="text-success">${{ total_monto|floatformat:0 }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Pendientes</h5>
                            <h3 class="text-warning">{{ facturas_pendientes }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Monto Pendiente</h5>
                            <h3 class="text-danger">${{ monto_pendiente|floatformat:0 }}</h3>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filtros de búsqueda -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-3">
                            <input type="text" name="q" class="form-control" placeholder="Buscar por número, proveedor..." value="{{ q }}">
                        </div>
                        <div class="col-md-2">
                            <select name="estado_pago" class="form-select">
                                <option value="">Todos los estados</option>
                                <option value="pendiente" {% if estado_pago_filter == 'pendiente' %}selected{% endif %}>Pendiente</option>
                                <option value="parcial" {% if estado_pago_filter == 'parcial' %}selected{% endif %}>Pago Parcial</option>
                                <option value="pagado" {% if estado_pago_filter == 'pagado' %}selected{% endif %}>Pagado</option>
                                <option value="cancelado" {% if estado_pago_filter == 'cancelado' %}selected{% endif %}>Cancelado</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select name="estado_recepcion" class="form-select">
                                <option value="">Todas</option>
                                <option value="pendiente" {% if estado_recepcion_filter == 'pendiente' %}selected{% endif %}>Pendiente (sin recibir)</option>
                                <option value="recibida" {% if estado_recepcion_filter == 'recibida' %}selected{% endif %}>Recibida</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="date" name="fecha_desde" class="form-control" value="{{ fecha_desde }}" placeholder="Desde">
                        </div>
                        <div class="col-md-2">
                            <input type="date" name="fecha_hasta" class="form-control" value="{{ fecha_hasta }}" placeholder="Hasta">
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-primary w-100">Buscar</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Tabla de facturas -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>N° Factura</th>
                                    <th>Proveedor</th>
                                    <th>Fecha</th>
                                    <th>Vencimiento</th>
                                    <th>Subtotal</th>
                                    <th>IVA</th>
                                    <th>Total</th>
                                    <th>Estado Pago</th>
                                    <th>Estado Recepción</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for factura in facturas %}
                                <tr>
                                    <td><strong>{{ factura.numero_factura }}</strong></td>
                                    <td>{{ factura.proveedor.nombre }}</td>
                                    <td>{{ factura.fecha_factura|date:"d/m/Y" }}</td>
                                    <td>
                                        {% if factura.fecha_vencimiento %}
                                            {{ factura.fecha_vencimiento|date:"d/m/Y" }}
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>${{ factura.subtotal_sin_iva|floatformat:0 }}</td>
                                    <td>${{ factura.total_iva|floatformat:0 }}</td>
                                    <td><strong>${{ factura.total_con_iva|floatformat:0 }}</strong></td>
                                    <td>
                                        {% if factura.estado_pago == 'pendiente' %}
                                            <span class="badge bg-warning">Pendiente</span>
                                        {% elif factura.estado_pago == 'parcial' %}
                                            <span class="badge bg-info">Parcial</span>
                                        {% elif factura.estado_pago == 'pagado' %}
                                            <span class="badge bg-success">Pagado</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Cancelado</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if factura.fecha_recepcion %}
                                            <span class="badge bg-success">Recibida</span>
                                        {% else %}
                                            <span class="badge bg-warning">Pendiente</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'factura_proveedor_detalle' factura.id %}" class="btn btn-sm btn-info">Ver</a>
                                        <a href="{% url 'factura_proveedor_editar' factura.id %}" class="btn btn-sm btn-warning">Editar</a>
                                        <a href="{% url 'factura_proveedor_eliminar' factura.id %}" class="btn btn-sm btn-danger">Eliminar</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="10" class="text-center text-muted">No se encontraron facturas.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

