{% extends "base.html" %}
{% load static %}

{% block body_class %}dark-gold-theme{% endblock %}

{% block contenido %}
<!-- ================================================================ -->
<!-- =                                                              = -->
<!-- =              COMPROBANTE DE VENTA (HTML)                    = -->
<!-- =                                                              = -->
<!-- ================================================================ -->
<!--
    Este template muestra el comprobante de venta según RF-V3 del Jira.
    Es un fallback cuando no está disponible reportlab para generar PDF.
    
    FUNCIONALIDADES:
    - Mostrar datos de la venta
    - Detalle de productos
    - Totales y pagos
    - Opción de imprimir
-->

<div class="dashboard-main-container">
    <!-- Sidebar de navegación -->
    {% include 'includes/sidebar.html' with active_page='pos' %}

    <div class="dashboard-content-wrapper">
        <!-- Header -->
        <header class="dashboard-header">
            <h1 class="dashboard-main-title">
                <i class="bi bi-receipt"></i> Comprobante de Venta
            </h1>
        </header>

        <!-- Contenido principal -->
        <main class="dashboard-content">
            
            <!-- Comprobante -->
            <div class="card mx-auto" style="max-width: 800px; background: rgba(26, 26, 26, 0.8); border: 2px solid #ffd700;">
                <div class="card-body p-4">
                    
                    <!-- Encabezado -->
                    <div class="text-center mb-4">
                        <h2 class="text-warning mb-1">LA FORNERÍA</h2>
                        <h5 class="text-muted">Comprobante de Venta</h5>
                    </div>

                    <!-- Información de la venta -->
                    <div class="mb-3">
                        <p class="mb-1"><strong>Folio:</strong> {{ venta.folio|default:"N/A" }}</p>
                        <p class="mb-1"><strong>Fecha:</strong> {{ venta.fecha|date:"d/m/Y" }}</p>
                        <p class="mb-1"><strong>Hora:</strong> {{ venta.fecha|date:"H:i:s" }}</p>
                        <p class="mb-1"><strong>Tipo:</strong> {{ venta.canal_venta|upper }}</p>
                    </div>

                    <div class="mb-3">
                        <p class="mb-1"><strong>Cliente:</strong> {{ venta.clientes.nombre|default:"Cliente Genérico" }}</p>
                    </div>

                    <!-- Detalle de productos -->
                    <div class="mb-4">
                        <h6 class="text-warning mb-3">Productos:</h6>
                        {% for detalle in detalles %}
                            <div class="mb-3">
                                <p class="mb-1"><strong>{{ detalle.productos.nombre }}</strong></p>
                                <p class="mb-1">Cantidad: {{ detalle.cantidad }}</p>
                                <p class="mb-1">Precio unitario (con IVA): {{ detalle.precio_unitario|floatformat:0 }}</p>
                                <p class="mb-1">Subtotal (con IVA): {{ detalle.calcular_subtotal|floatformat:0 }}</p>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Totales -->
                    <div class="mb-4">
                        <p class="mb-1"><strong>SubTotal (sin IVA):</strong> {{ venta.total_sin_iva|floatformat:0 }}</p>
                        <p class="mb-1"><strong>IVA 19%:</strong> {{ venta.total_iva|floatformat:0 }}</p>
                        <p class="mb-1"><strong>Total (con IVA):</strong> <strong class="text-warning">{{ venta.total_con_iva|floatformat:0 }}</strong></p>
                    </div>

                    <!-- Información de pago -->
                    {% if venta.monto_pagado %}
                        <div class="mb-4">
                            <p class="mb-1"><strong>Medio de pago:</strong> 
                                {% if venta.medio_pago == 'efectivo' %}Efectivo
                                {% elif venta.medio_pago == 'tarjeta_debito' %}Tarjeta Débito
                                {% elif venta.medio_pago == 'tarjeta_credito' %}Tarjeta Crédito
                                {% elif venta.medio_pago == 'transferencia' %}Transferencia
                                {% elif venta.medio_pago == 'cheque' %}Cheque
                                {% elif venta.medio_pago == 'otro' %}Otro
                                {% else %}Efectivo{% endif %}
                            </p>
                            <p class="mb-1"><strong>Pago recibido:</strong> {{ venta.monto_pagado|floatformat:0 }}</p>
                            {% if venta.medio_pago == 'efectivo' and venta.vuelto %}
                            <p class="mb-1"><strong>Vuelto:</strong> {{ venta.vuelto|floatformat:0 }}</p>
                            {% endif %}
                        </div>
                    {% endif %}

                    <!-- Pie de página -->
                    <div class="text-center mt-4">
                        <p class="text-muted">Gracias por su compra. Síganos en @LaForneria</p>
                    </div>

                </div>
            </div>

            <!-- Botones de acción -->
            <div class="text-center mt-4">
                <a href="{% url 'comprobante_pdf' venta.id %}" class="btn btn-primary">
                    <i class="bi bi-file-pdf"></i> Descargar PDF
                </a>
                <button onclick="window.print()" class="btn btn-success">
                    <i class="bi bi-printer"></i> Imprimir
                </button>
                <a href="{% url 'pos' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Volver al POS
                </a>
            </div>

        </main>
    </div>
</div>

<!-- Estilos para impresión -->
<style>
    @media print {
        .dashboard-main-container {
            background: white !important;
        }
        .dashboard-header,
        .btn,
        .sidebar {
            display: none !important;
        }
        .card {
            border: none !important;
            box-shadow: none !important;
        }
    }
</style>
{% endblock %}

